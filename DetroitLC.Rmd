---
title: "Detroit Metro Land Cover Data"
author: "K. Arthur Endsley"
date: "Wednesday, November 05, 2014"
output: pdf_document
---

# Data Sources

All dollar values were adjusted for inflation to 2010 values.

**Used in analysis:**
* [2000 and 2010 Census tract boundaries](http://semcog.org/MapCatalog_Demographic.aspx) - SEMCOG

**Alternatives:** 
* [2000 Census tract boundaries](http://www.mcgi.state.mi.us/mgdl/?rel=thext&action=thmname&cid=16&cat=2000+Tracts+from+MI+Geographic+Framework+%28v14a%29)
* [2010 Census tract boundaries](http://www.mcgi.state.mi.us/mgdl/?rel=thext&action=thmname&cid=16&cat=2010+Tracts+from+MI+Geographic+Framework+%28v14a%29) (Used for 2006 ACS as well)

## Potential SocialExplorer Census Measures

Variable names are given in parentheses as (2000 Census, American Community Survey).

* Population density (`SE_T003_001`, `SE_T002_001`)
* Median household income (`SE_T093_001`, `SE_T057_001`)

* Normalized by housing unit count (`SE_T155_001`, `SE_T093_001`)...
  * Occupied housing units (`SE_T156_001`, `SE_T094_001`)
  * Occupied housing units: owner occupied (`SE_T156_002`, `SE_T094_002`)

* Normalized by land area (`SE_T004_002`, `SE_T002_003`)...
  * Housing unit count (`SE_T155_001`, `SE_T093_001`)
  * Households (`SE_T020_001`, `SE_T017_001`)
  * Family households (`SE_T020_002`, `SE_T017_002`)
  * Married-couple households (`SE_T020_003`, `SE_T017_003`)
  * Family households with Male householder, no spouse present (`SE_T020_005`, `SE_T017_005`)
  * Family households with Female householder, no spouse present (`SE_T020_006`, `SE_T017_006`)
  * Non-family households with Male householder (`SE_T020_008`, `SE_T017_008`)
  * Non-family households with Female householder (`SE_T020_009`, `SE_T017_009`)
  
* Normalized by family household population (`SE_T025_003`, (None))...
  * Householders (`SE_T025_004`, (None))
  * Children in households (`SE_T025_006`, (None))
  * Grandchildren in households (`SE_T025_007`, (None))
  * Parents in households (`SE_T025_009`, (None))
  * Non-relatives in households (`SE_T025_011`, (None))
  
* Normalized by non-family household population (`SE_T025_012`, (None))...
  * Population living alone (`SE_T025_013`, (None))
  
* Normalized by total population (`SE_T025_001`, `SE_T001_001`)...
  * Male population (`SE_T005_002`, `SE_T004_002`)
  * Female population (`SE_T005_003`, `SE_T004_003`)
  * White population (`SE_T014_002`, `SE_T013_002`)
  * Black or African American population (`SE_T014_003`, `SE_T013_003`)
  * Asian population (`SE_T014_005`, `SE_T013_005`)
  * Population in group quarters (`SE_T025_016`, (None))
  * Population 16 years and over (`SE_T069_001`, (None))
  * Population poor or struggling (`SE_T185_004`, `SE_T118_004`)

* Normalized by population in group quarters (`SE_T025_016`, (None))...
  * Institutionalized population (`SE_T025_017`, (None))
  
* Normalized by population 16 years and over (`SE_T069_001`, (None))...
  * Population 16 and over in the labor force (`SE_T069_002`, (None))
  
* Normalized by population 16 and over in the labor force (`SE_T069_002`, (None))...
  * Employed civilians in the labor force (`SE_T069_005`, (None))

## U.S. Census

* [Decennial Census overview and 1990, 2000 datasets](http://www.census.gov/prod/www/decennial.html)
* [Maps and geographic data](http://www.census.gov/geo/maps-data/)

# Methodology

1. Interpolate 2000 Census data to 2010 Census tract boundaries.
2. Normalize 2000 Census and ACS 2006 measures.
3. Join census tract attributes to census tract boundaries.
4. [For SEMCOG data... Create common grid of SEMCOG layers.]
5. Rasterize census tracts to NLCD grid.
6. Set up Bayesian network.
7. Learn Bayesian network on 2001 NLCD up to 2006 NLCD.

## Cross-Walking Census Data

From [U.S. 2010: Discover America in a New Century](http://www.s4.brown.edu/us2010/Researcher/ltdb3.htm): "The crosswalk identifies what portion of a tract in one year should be allocated to a 2010 tract. For every decennial year from 1970 to 2000, every row in the crosswalk lists a 2010 tract ID, the ID of a tract in the source year that contributes to it, and the share of the source tract's population attributes that should be allocated to the 2010 tract. In cases where there is an exact correspondence between the source tract and the 2010 tract, there is only one row of data for the 2010 tract. Otherwise there are as many rows as there are contributing tracts."

Reference to use is: "John R. Logan, Zengwang Xu, and Brian Stults. 2012. “Interpolating US Decennial Census Tract Data from as Early as 1970 to 2010: A Longitudinal Tract Database” Professional Geographer, forthcoming."

```
chmod 664 crosswalk_2000_2010.csv
sudo -u arthur psql -d rdetroit -c "CREATE TABLE census_crosswalk (trtid00 character varying(255), trtid10 character varying(255), weight numeric, placefp10 integer, cbsa10 integer, metdiv10 integer, ccflag10 integer, changetype integer)"
sudo -u arthur psql -d rdetroit -c "COPY census_crosswalk (trtid00, trtid10, weight, placefp10, cbsa10, metdiv10, ccflag10, changetype) FROM '/home/arthur/Downloads/crosswalk_2000_2010.csv' WITH (FORMAT csv, HEADER)"
```

## Interpolating 2000 Census Tracts to 2010 Census Tracts

```{r}
setwd('/home/arthur/Downloads')
options(stringsAsFactors=FALSE)

census.vars <- c('SE_T003_001', 'SE_T093_001', 'SE_T155_001', 'SE_T156_001', 'SE_T156_002', 'SE_T004_002', 'SE_T005_002', 'SE_T005_003', 'SE_T014_002', 'SE_T014_003', 'SE_T014_005', 'SE_T020_001', 'SE_T020_002', 'SE_T020_003', 'SE_T020_005', 'SE_T020_006', 'SE_T020_008', 'SE_T020_009', 'SE_T025_001', 'SE_T185_004')
acs.vars <- c('SE_T002_001', 'SE_T001_001', 'SE_T004_002', 'SE_T004_003', 'SE_T002_003', 'SE_T057_001', 'SE_T093_001', 'SE_T094_001', 'SE_T094_002', 'SE_T017_001', 'SE_T017_002', 'SE_T017_003', 'SE_T017_005', 'SE_T017_006', 'SE_T017_008', 'SE_T017_009', 'SE_T013_002', 'SE_T013_003', 'SE_T013_005', 'SE_T118_004')

census2000 <- read.csv('census2000.csv', header=T, skip=1,
                       colClasses=c('Geo_FIPS'='character')) # 2000 Census data
acs2006.2010 <- read.csv('acs2006-2010.csv', header=T, skip=1,
                       colClasses=c('Geo_FIPS'='character')) # 2006-2010 ACS data
tracts <- union(census2000$Census.Tract, acs2006.2010$Census.Tract)
xwalk <- arrange(read.csv('crosswalk_2000_2010.csv', colClasses=c('character', 'character')),
                 trtid10) # 2000 to 2010 Crosswalk data
xwalk <- within(xwalk, weight <- as.numeric(weight))

require(plyr)
census2000 <- subset(mutate(census2000, trtid00=Geo_FIPS), select=c('trtid00', census.vars))
acs2006.2010 <- subset(acs2006.2010, select=c('Geo_FIPS', acs.vars))

# Subset the crosswalk table to just those tracts in our census data
xwalk <- subset(xwalk, trtid00 %in% intersect(census2000$trtid00, xwalk$trtid00),
                select=c(trtid00, trtid10, weight))

# We interpolate the 2000 census tracts to 2010 census tracts by a weighted linear combination
require(reshape2)
temp <- melt(join(xwalk, census2000, by=c('trtid00')),
            id.vars=c('trtid00', 'trtid10', 'weight'))
temp <- within(temp, value <- value * weight) # Scale the census measures by Brown et al.'s weights

# Recast 2010 census tracts as a sum of the 2000 census measures
census2000.as.2010 <- within(dcast(temp, trtid10 ~ variable, fun.aggregate=sum, value.var='value'),
                             Geo_FIPS <- trtid10)

# For some reason, a couple of tracts in the ACS are not in the 2010 interpolation of the 2000 census
disjoint.tracts <- union(setdiff(census2000.as.2010$Geo_FIPS, acs2006.2010$Geo_FIPS),
                         setdiff(acs2006.2010$Geo_FIPS, census2000.as.2010$Geo_FIPS))

acs2006.2010 <- subset(acs2006.2010, !Geo_FIPS %in% disjoint.tracts)
census2000.as.2010 <- subset(census2000.as.2010, !Geo_FIPS %in% disjoint.tracts)
```

## Normalizing Census Data

```{r}
# Non-iterative normalization; normalizing constants are not updated
census2000.as.2010 <- transform(census2000.as.2010,
  SE_T156_001=SE_T156_001 / SE_T155_001, # Occupied housing units normalized by housing unit count
  SE_T156_002=SE_T156_002 / SE_T155_001, # Owner-occupied units normalized by housing unit count
  SE_T155_001=SE_T155_001 / SE_T004_002, # Housing unit count normalized by land area
  SE_T020_001=SE_T020_001 / SE_T004_002, # Households...by land area
  SE_T020_002=SE_T020_002 / SE_T004_002, # Family households...by land area
  SE_T020_003=SE_T020_003 / SE_T004_002, # Married-couple households...by land area
  SE_T020_005=SE_T020_005 / SE_T004_002, # Family households with lone male householder...by land area
  SE_T020_006=SE_T020_006 / SE_T004_002, # Family households with lone female householder...land area
  SE_T020_008=SE_T020_008 / SE_T004_002, # Non-family households with male householder...by land area
  SE_T020_009=SE_T020_009 / SE_T004_002, # Non-family households with female householder...land area
  SE_T005_002=SE_T005_002 / SE_T025_001, # Male population normalized by total population
  SE_T005_003=SE_T005_003 / SE_T025_001, # Female population normalized by total pop.
  SE_T014_002=SE_T014_002 / SE_T025_001, # White population...total pop.
  SE_T014_003=SE_T014_003 / SE_T025_001, # Black population...total pop.
  SE_T014_005=SE_T014_005 / SE_T025_001, # Asian population...total pop.
  SE_T185_004=SE_T185_004 / SE_T025_001) # Population poor or struggling...total pop.
acs2006.2010 <- transform(acs2006.2010,
  SE_T094_001=SE_T094_001 / SE_T093_001, # Occupied housing units normalized by housing unit count
  SE_T094_002=SE_T094_002 / SE_T093_001, # Owner-occupied units normalized by housing unit count
  SE_T093_001=SE_T093_001 / SE_T002_003, # Housing unit count normalized by land area
  SE_T017_001=SE_T017_001 / SE_T002_003, # Households...by land area
  SE_T017_002=SE_T017_002 / SE_T002_003, # Family households...by land area
  SE_T017_003=SE_T017_003 / SE_T002_003, # Married-couple households...by land area
  SE_T017_005=SE_T017_005 / SE_T002_003, # Family households with lone male householder...by land area
  SE_T017_006=SE_T017_006 / SE_T002_003, # Family households with lone female householder...land area
  SE_T017_008=SE_T017_008 / SE_T002_003, # Non-family households with male householder...by land area
  SE_T017_009=SE_T017_009 / SE_T002_003, # Non-family households with female householder...land area
  SE_T004_002=SE_T004_002 / SE_T001_001, # Male population normalized by total population
  SE_T004_003=SE_T004_003 / SE_T001_001, # Female population normalized by total pop.
  SE_T013_002=SE_T013_002 / SE_T001_001, # White population...total pop.
  SE_T013_003=SE_T013_003 / SE_T001_001, # Black population...total pop.
  SE_T013_005=SE_T013_005 / SE_T001_001, # Asian population...total pop.
  SE_T118_004=SE_T118_004 / SE_T001_001) # Population poor or struggling...total pop.
```

## Land Cover Data Preparation

```{r preamble, warning=FALSE, results=FALSE, message=FALSE}
library(sp)
library(raster)
library(rgdal)
```

```{r data.management}
file.loc <- '/home/arthur/Workspace/TermProject/'
rast <- raster::raster(paste0(file.loc, 'nlcd2001_sample.tif'))
```

Next, I reclassify the NLCD raster into three classes:

```{r reclass.explication, echo=FALSE}
knitr::kable(data.frame('Input Class Range'=c('[0-10]', '11 (Open Water)', '[12-20]', '[21-23] (Open and Low, Medium Development)', '24 (High Development)', '[25-99]'), 'Output Class'=c(0,NA,0,1,2,0), 'New Class Label'=c('Undeveloped', 'Excluded', 'Undeveloped', 'Low-Intensity Development', 'High-Intensity Development', 'Undeveloped')), col.names=c('Input Class Range', 'Output Class', 'New Class Label'))
```

```{r reclass}
reclass.matrix <- matrix(c(c(0,10,0), c(10,11,NA), c(12,20,0),
                           c(20,23,1), c(23,24,2), c(24,99,0)),
                         byrow=TRUE, ncol=3)
dev <- reclassify(rast, reclass.matrix, right=TRUE) # Intervals closed on right
```

# Questions

* What census tract boundaries are used in the American Community Survey? \textbf{The 2010 tract boundaries are used.} [(Source)](http://www.census.gov/geo/maps-data/data/pdfs/tiger/How_do_I_choose_TIGER_vintage.pdf)

